# 2025-12-19 JWXT UI E2E Notes (Chrome MCP)

> Purpose: keep a **traceable**, **sanitized** record of the current JWXT SSO + 自主选课 (enroll/drop) flow.
> No credentials/cookies/tokens are included (per `spec://cluster/jwxt#chunk-01`).

## 1) Auth entry / failure signal

- **Entry**: `http://jwxt.shu.edu.cn/sso/shulogin` (HTTP is important; it reliably triggers `newsso.shu.edu.cn`).
- **Then**: after SSO, landing in `https://jwxt.shu.edu.cn/jwglxt/xtgl/index_initMenu.html?jsdm=xs`.
- **Failure signal**: landing on `https://jwxt.shu.edu.cn/jwglxt/xtgl/login_slogin.html` means SSO didn’t establish a valid session; treat as login failure.

## 2) Enroll + drop verification (real side effects)

Test page:

- `https://jwxt.shu.edu.cn/jwglxt/xsxk/zzxkyzb_cxZzxkYzbIndex.html?doType=details&gnmkdm=N253512&layout=default`

Observed UI handlers:

- Enroll: page button calls `chooseCourseZzxk(jxb_id, do_jxb_id, kch_id, jxbzls)`
- Drop: page button calls `cancelCourseZzxk(...)`
- Confirmation dialog appears on drop (“您确定要退掉该课程吗？”)

E2E result:

- Enroll succeeded (UI shows the course group as “已选”, credit sum increases).
- Drop succeeded after confirming the dialog (course returns to “未选”, credit sum returns).

## 3) Observed endpoints (network)

### 3.1 Enroll (write)

- `POST /jwglxt/xsxk/zzxkyzbjk_xkBcZyZzxkYzb.html?gnmkdm=N253512`
- Content-Type: `application/x-www-form-urlencoded;charset=UTF-8`
- Response (success): `{"flag":"1"}`

Request body keys (sample from UI; values vary by term/round/course):

- `jxb_ids`, `kch_id`, `kcmc`, `rwlx`
- `rlkz`, `cdrlkz`, `rlzlkz`
- `sxbj`, `xxkbj`, `qz`, `cxbj`
- `xkkz_id`, `njdm_id`, `zyh_id`, `kklxdm`, `xklc`, `xkxnm`, `xkxqm`, `jcxx_id`

Notable:

- `xklc` is present in the UI write payload (round meta).
- `xkkz_id` is the stable round key.

### 3.2 Drop (write, ref-aligned)

- `POST /jwglxt/xsxk/zzxkyzb_tuikBcZzxkYzb.html?gnmkdm=N253512`
- Response (success): `"1"`

Request body keys:

- `kch_id`, `jxb_ids`, `xkxnm`, `xkxqm`, `txbsfrl`

### 3.3 Post-drop follow-up

- `POST /jwglxt/xsxk/zzxkyzb_xkBcZypxZzxkYzb.html?gnmkdm=N253512`
  - (observed body sample: `zypxs=&jxb_ids=`; response `"success"`)

## 4) Implementation alignment (repo pointers)

- Userscript/server shared enroll/drop builders/parsers:
  - `app/shared/jwxtCrawler/enroll.ts`
- Userscript/server shared selection parsing/merge:
  - `app/shared/jwxtCrawler/selection.ts`

